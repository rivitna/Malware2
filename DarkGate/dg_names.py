import io
import hashlib


# DarkGate configuration data field "10"
CFG_MAGIC = 'cabcaC'


NAME_LIST = [ 'mutex',
              'mainhw',
              'update',
              'au3file',
              'st2path',
              'st2',
              'a',
              'rnd',
              'mainfolder',
              'logsfolder',
              'addonsfolder',
              'settings',
              'resources',
              'binder',
              'minercpu2',
              'supertemp' ]


RND_NAME_LEN = 7

HEX_DIGITS = 'abcdefKhABCDEFGHW'


def get_md5_customhexdigest(data: bytes) -> str:
    """Get MD5 digest with non-standard digits"""
    res = ''
    h = hashlib.md5(data).digest()
    for b in h:
        res += HEX_DIGITS[(b >> 4) & 0xF] + HEX_DIGITS[b & 0xF]
    return res


def make_rnd_name(hwid: str, s: str) -> str:
    """Make random name"""
    data = bytes(s + hwid + CFG_MAGIC, 'ascii')
    hexdigest = get_md5_customhexdigest(data)
    return hexdigest[:RND_NAME_LEN].lower()


#
# Main
#
with io.open('sysid.txt', 'rb') as f:
    # ProductID, CPUInfo, UserName, ComputerName
    sysid_data_list = f.read().splitlines(False)

# HWID
hwid = get_md5_customhexdigest(b''.join(sysid_data_list))
print('HWID:', hwid)

for n in NAME_LIST:
    s = make_rnd_name(hwid, n)
    print('\"%s\": \"%s\"' % (n, s))
